@model IEnumerable<SimpleInventory.Domain.Entities.Product>
@{
    ViewData["Title"] = "Products";
    var total = (int)(ViewBag.Total ?? 0);
    var page = (int)(ViewBag.Page ?? 1);
    var pageSize = (int)(ViewBag.PageSize ?? 10);
    var sort = (string)(ViewBag.Sort ?? "");
    var q = (string)(ViewBag.Query ?? "");
    int totalPages = (int)Math.Ceiling(total / (double)pageSize);
}

<h2>Products</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
        <input name="q" value="@q" class="form-control" placeholder="Search name or SKU" />
    </div>
    <div class="col-md-3">
        <select name="categoryId" class="form-select" asp-items="ViewBag.Categories">
            <option value="">All Categories</option>
        </select>
    </div>
    <div class="col-md-2">
        <select name="sort" class="form-select">
            <option value="">Name (asc)</option>
            <option value="name_desc" selected="@(sort=="name_desc")">Name (desc)</option>
            <option value="price" selected="@(sort=="price")">Price (asc)</option>
            <option value="price_desc" selected="@(sort=="price_desc")">Price (desc)</option>
        </select>
    </div>
    <div class="col-md-2">
        <button class="btn btn-primary w-100" type="submit">Filter</button>
    </div>
    <div class="col-md-1 text-end">
        <a asp-action="Create" class="btn btn-success w-100">Create</a>
    </div>
    <input type="hidden" name="page" value="@(page)" />
    <input type="hidden" name="pageSize" value="@pageSize" />
    <input type="hidden" name="q" value="@q" />
    <input type="hidden" name="sort" value="@sort" />
    <input type="hidden" name="categoryId" value="@ViewBag.CategoryId" />
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th>SKU</th>
            <th>Name</th>
            <th class="text-end">Price</th>
            <th class="text-end">Qty</th>
            <th>Category</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.Sku</td>
            <td>@item.Name</td>
            <td class="text-end">@item.Price.ToString("C")</td>
            <td class="text-end">@item.Quantity</td>
            <td>@item.Category?.Name</td>
            <td class="text-end">
                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-primary">Edit</a>
                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">Delete</a>
            </td>
        </tr>
    }
    </tbody>
</table>

<nav aria-label="Page navigation">
    <ul class="pagination">
        <li class="page-item @(page==1?"disabled":null)">
            <a class="page-link" asp-action="Index" asp-route-page="@(page-1)" asp-route-pageSize="@pageSize" asp-route-q="@q" asp-route-categoryId="@ViewBag.CategoryId" asp-route-sort="@sort">Previous</a>
        </li>
        @for (int i = 1; i <= totalPages; i++)
        {
            <li class="page-item @(i==page?"active":null)">
                <a class="page-link" asp-action="Index" asp-route-page="@i" asp-route-pageSize="@pageSize" asp-route-q="@q" asp-route-categoryId="@ViewBag.CategoryId" asp-route-sort="@sort">@i</a>
            </li>
        }
        <li class="page-item @(page==totalPages||totalPages==0?"disabled":null)">
            <a class="page-link" asp-action="Index" asp-route-page="@(page+1)" asp-route-pageSize="@pageSize" asp-route-q="@q" asp-route-categoryId="@ViewBag.CategoryId" asp-route-sort="@sort">Next</a>
        </li>
    </ul>
    <span class="text-muted">Showing page @(page) of @(totalPages) (@(total) total)</span>
    </nav>


